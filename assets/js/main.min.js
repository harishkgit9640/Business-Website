$(document).ready(function () {
  AOS.init({ duration: 800, once: !0 });

  // $("#menu-btn").on("click", function () {
  //   $("#sidebar").toggleClass("hidden");
  // });

  // 1) DEFINE FUNCTION FIRST
  function setInitialSidebarState() {
    if (window.innerWidth < 1024) {
      // <lg
      $("#sidebar").css({ left: "-300px" }).addClass("hidden");
    } else {
      $("#sidebar").css({ left: "0px" }).removeClass("hidden");
    }
  }

  // 2) CALL IT AFTER DEFINITION
  setInitialSidebarState();

  // 3) RESIZE HANDLER
  $(window).on("resize", function () {
    setInitialSidebarState();
  });

  // 4) TOGGLE SIDEBAR (slide in/out)
  $("#menu-btn").on("click", function () {
    if (window.innerWidth < 1024) {
      // If sidebar is hidden → slide in
      if ($("#sidebar").hasClass("hidden")) {
        $("#sidebar").removeClass("hidden").animate({ left: "0px" }, 300);
      }

      // If sidebar is visible → slide out
      else {
        $("#sidebar").animate({ left: "-300px" }, 300, function () {
          $(this).addClass("hidden");
        });
      }
    }
  });

  // 5) CLOSE SLIDE FUNCTION
  function closeSidebar() {
    $("#sidebar").animate({ left: "-300px" }, 300, function () {
      $(this).addClass("hidden");
    });
  }

  // 6) OUTSIDE CLICK TO CLOSE
  $(document).on("click", function (e) {
    if (
      window.innerWidth < 1024 &&
      !$(e.target).closest("#sidebar, #menu-btn").length
    ) {
      closeSidebar();
    }
  });

  const a = window.location.href;
  var s, i;
  $("#sidebar a").each(function () {
    var s = this.href,
      i = this.hash,
      t = a.split("#")[0],
      e = s.split("#")[0];
    (s === a || (i && -1 !== a.indexOf(i)) || (e === t && !i)) &&
      $(this).closest("li").addClass("active");
  }),
    $("#servicesList").on("click", "a", function (s) {
      var [i, t] = $(this).attr("href").split("#");
      window.location.pathname.split("/").pop() === i &&
        (s.preventDefault(), (i = $("#" + t)).length) &&
        ($("#servicesList li.sub_nav_link").removeClass("active"),
        $(this).closest("li.sub_nav_link").addClass("active"),
        history.pushState(null, null, "#" + t),
        $("html, body").animate({ scrollTop: i.offset().top - 150 }, 700));
    }),
    (i = window.location.hash) &&
      (s = $(i)).length &&
      ($("#servicesList li.sub_nav_link").removeClass("active"),
      $("#servicesList a[href$='" + i + "']")
        .closest("li.sub_nav_link")
        .addClass("active"),
      $("html, body").animate({ scrollTop: s.offset().top - 100 }, 700));
});

$(document).on("click", ".learn-more-btn", function () {
  const target = $(this).data("target");
  const content = $("." + target);
  const arrow = $(this).find("svg");

  if (content.hasClass("hidden")) {
    // Open
    content.hide().removeClass("hidden").slideDown(300);
    $(this).find("span").text("Show less");
    arrow.addClass("rotate-180");
  } else {
    // Close
    content.slideUp(300, () => {
      content.addClass("hidden");
    });
    $(this).find("span").text("Learn more");
    arrow.removeClass("rotate-180");
  }
});
