$(document).ready(function () {
  function i() {
    window.innerWidth < 1024
      ? $("#sidebar").css({ left: "-300px" }).addClass("hidden")
      : $("#sidebar").css({ left: "0px" }).removeClass("hidden");
  }
  AOS.init({ duration: 800, once: !0 }),
    i(),
    $(window).on("resize", function () {
      i();
    }),
    $("#menu-btn").on("click", function () {
      window.innerWidth < 1024 &&
        ($("#sidebar").hasClass("hidden")
          ? $("#sidebar").removeClass("hidden").animate({ left: "0px" }, 300)
          : $("#sidebar").animate({ left: "-300px" }, 300, function () {
              $(this).addClass("hidden");
            }));
    }),
    $(document).on("click", function (i) {
      window.innerWidth < 1024 &&
        !$(i.target).closest("#sidebar, #menu-btn").length &&
        $("#sidebar").animate({ left: "-300px" }, 300, function () {
          $(this).addClass("hidden");
        });
    }),
    $("#servicesList").on("click", "a", function (i) {
      var [s, t] = $(this).attr("href").split("#");
      window.location.pathname.split("/").pop() === s &&
        (i.preventDefault(), (s = $("#" + t)).length) &&
        ($("#servicesList li.sub_nav_link").removeClass("active"),
        $(this).closest("li.sub_nav_link").addClass("active"),
        history.pushState(null, null, "#" + t),
        $("html, body").animate({ scrollTop: s.offset().top - 150 }, 700),
        window.innerWidth < 1024) &&
        $("#sidebar").animate({ left: "-300px" }, 300, function () {
          $(this).addClass("hidden");
        });
    });
  const n = window.location.href;
  var s, t;
  $("#sidebar a").each(function () {
    var i = this.href,
      s = this.hash,
      t = n.split("#")[0],
      e = i.split("#")[0];
    (i === n || (s && -1 !== n.indexOf(s)) || (e === t && !s)) &&
      $(this).closest("li").addClass("active");
  }),
    $("#servicesList").on("click", "a", function (i) {
      var [s, t] = $(this).attr("href").split("#");
      window.location.pathname.split("/").pop() === s &&
        (i.preventDefault(), (s = $("#" + t)).length) &&
        ($("#servicesList li.sub_nav_link").removeClass("active"),
        $(this).closest("li.sub_nav_link").addClass("active"),
        history.pushState(null, null, "#" + t),
        $("html, body").animate({ scrollTop: s.offset().top - 150 }, 700));
    }),
    (t = window.location.hash) &&
      (s = $(t)).length &&
      ($("#servicesList li.sub_nav_link").removeClass("active"),
      $("#servicesList a[href$='" + t + "']")
        .closest("li.sub_nav_link")
        .addClass("active"),
      $("html, body").animate({ scrollTop: s.offset().top - 150 }, 700));
}),
  $(document).on("click", ".learn-more-btn", function () {
    var i = $(this).data("target");
    const s = $("." + i);
    i = $(this).find("svg");
    s.hasClass("hidden")
      ? (s.hide().removeClass("hidden").slideDown(300),
        $(this).find("span").text("Show less"),
        i.addClass("rotate-180"))
      : (s.slideUp(300, () => {
          s.addClass("hidden");
        }),
        $(this).find("span").text("Learn more"),
        i.removeClass("rotate-180"));
  });


//  Image View Modal =======

$("#image_wrapper img").on("click", function () {
    $("#full-image").attr("src", $(this).attr("src"));
    $("#image-viewer").fadeIn(200);
});

// Close button
$("#image-viewer .close").on("click", function () {
    closeImageViewer();
});

// ESC key to close
$(document).on("keydown", function (e) {
    if (e.key === "Escape") {
        closeImageViewer();
    }
});

// Click outside modal image to close
$(document).on("click", function (e) {
    const viewer = $("#image-viewer");
    const content = $("#image-viewer .modal-content");

    // If modal is open AND clicked outside modal-content AND not clicking gallery images
    if (
        viewer.is(":visible") &&
        !$(e.target).closest(content).length &&
        !$(e.target).closest("#image_wrapper img").length
    ) {
        closeImageViewer();
    }
});

// Central close function
function closeImageViewer() {
    $("#image-viewer").fadeOut(200);
}
